<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kysoft.cpsi.repo.mapper.ScztMapper">
  <resultMap id="BaseResultMap" type="com.kysoft.cpsi.repo.entity.Sczt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    <id column="XYDM" jdbcType="VARCHAR" property="xydm" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="HYFL" jdbcType="DECIMAL" property="hyfl" />
    <result column="ZZXS" jdbcType="DECIMAL" property="zzxs" />
    <result column="JYZT" jdbcType="DECIMAL" property="jyzt" />
    <result column="FR" jdbcType="VARCHAR" property="fr" />
    <result column="LXDH" jdbcType="VARCHAR" property="lxdh" />
    <result column="MAIL" jdbcType="VARCHAR" property="mail" />
    <result column="DJJG" jdbcType="VARCHAR" property="djjg" />
    <result column="JYDZ" jdbcType="VARCHAR" property="jydz" />
    <result column="LLR" jdbcType="VARCHAR" property="llr" />
    <result column="QYBM" jdbcType="VARCHAR" property="qybm" />
    <result column="QYMC" jdbcType="VARCHAR" property="qymc" />
    <result column="CLRQ" jdbcType="TIMESTAMP" property="clrq" />
    <result column="ZS" jdbcType="VARCHAR" property="zs" />
    <result column="ZTLX" jdbcType="VARCHAR" property="ztlx" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    XYDM, NAME, HYFL, ZZXS, JYZT, FR, LXDH, MAIL, DJJG, JYDZ, LLR, QYBM, QYMC, CLRQ, 
    ZS, ZTLX
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    select 'false' as QUERYID,
    <include refid="Base_Column_List" />
    from T_SCZT
    where XYDM = #{xydm,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    delete from T_SCZT
    where XYDM = #{xydm,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.kysoft.cpsi.repo.entity.Sczt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    insert into T_SCZT (XYDM, NAME, HYFL, 
      ZZXS, JYZT, FR, LXDH, 
      MAIL, DJJG, JYDZ, LLR, 
      QYBM, QYMC, CLRQ, 
      ZS, ZTLX)
    values (#{xydm,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{hyfl,jdbcType=DECIMAL}, 
      #{zzxs,jdbcType=DECIMAL}, #{jyzt,jdbcType=DECIMAL}, #{fr,jdbcType=VARCHAR}, #{lxdh,jdbcType=VARCHAR}, 
      #{mail,jdbcType=VARCHAR}, #{djjg,jdbcType=VARCHAR}, #{jydz,jdbcType=VARCHAR}, #{llr,jdbcType=VARCHAR}, 
      #{qybm,jdbcType=VARCHAR}, #{qymc,jdbcType=VARCHAR}, #{clrq,jdbcType=TIMESTAMP}, 
      #{zs,jdbcType=VARCHAR}, #{ztlx,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.kysoft.cpsi.repo.entity.Sczt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    insert into T_SCZT
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="xydm != null">
        XYDM,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="hyfl != null">
        HYFL,
      </if>
      <if test="zzxs != null">
        ZZXS,
      </if>
      <if test="jyzt != null">
        JYZT,
      </if>
      <if test="fr != null">
        FR,
      </if>
      <if test="lxdh != null">
        LXDH,
      </if>
      <if test="mail != null">
        MAIL,
      </if>
      <if test="djjg != null">
        DJJG,
      </if>
      <if test="jydz != null">
        JYDZ,
      </if>
      <if test="llr != null">
        LLR,
      </if>
      <if test="qybm != null">
        QYBM,
      </if>
      <if test="qymc != null">
        QYMC,
      </if>
      <if test="clrq != null">
        CLRQ,
      </if>
      <if test="zs != null">
        ZS,
      </if>
      <if test="ztlx != null">
        ZTLX,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="xydm != null">
        #{xydm,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="hyfl != null">
        #{hyfl,jdbcType=DECIMAL},
      </if>
      <if test="zzxs != null">
        #{zzxs,jdbcType=DECIMAL},
      </if>
      <if test="jyzt != null">
        #{jyzt,jdbcType=DECIMAL},
      </if>
      <if test="fr != null">
        #{fr,jdbcType=VARCHAR},
      </if>
      <if test="lxdh != null">
        #{lxdh,jdbcType=VARCHAR},
      </if>
      <if test="mail != null">
        #{mail,jdbcType=VARCHAR},
      </if>
      <if test="djjg != null">
        #{djjg,jdbcType=VARCHAR},
      </if>
      <if test="jydz != null">
        #{jydz,jdbcType=VARCHAR},
      </if>
      <if test="llr != null">
        #{llr,jdbcType=VARCHAR},
      </if>
      <if test="qybm != null">
        #{qybm,jdbcType=VARCHAR},
      </if>
      <if test="qymc != null">
        #{qymc,jdbcType=VARCHAR},
      </if>
      <if test="clrq != null">
        #{clrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zs != null">
        #{zs,jdbcType=VARCHAR},
      </if>
      <if test="ztlx != null">
        #{ztlx,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.kysoft.cpsi.repo.entity.Sczt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    update T_SCZT
    <set>
      <if test="name != null">
        NAME = #{name,jdbcType=VARCHAR},
      </if>
      <if test="hyfl != null">
        HYFL = #{hyfl,jdbcType=DECIMAL},
      </if>
      <if test="zzxs != null">
        ZZXS = #{zzxs,jdbcType=DECIMAL},
      </if>
      <if test="jyzt != null">
        JYZT = #{jyzt,jdbcType=DECIMAL},
      </if>
      <if test="fr != null">
        FR = #{fr,jdbcType=VARCHAR},
      </if>
      <if test="lxdh != null">
        LXDH = #{lxdh,jdbcType=VARCHAR},
      </if>
      <if test="mail != null">
        MAIL = #{mail,jdbcType=VARCHAR},
      </if>
      <if test="djjg != null">
        DJJG = #{djjg,jdbcType=VARCHAR},
      </if>
      <if test="jydz != null">
        JYDZ = #{jydz,jdbcType=VARCHAR},
      </if>
      <if test="llr != null">
        LLR = #{llr,jdbcType=VARCHAR},
      </if>
      <if test="qybm != null">
        QYBM = #{qybm,jdbcType=VARCHAR},
      </if>
      <if test="qymc != null">
        QYMC = #{qymc,jdbcType=VARCHAR},
      </if>
      <if test="clrq != null">
        CLRQ = #{clrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zs != null">
        ZS = #{zs,jdbcType=VARCHAR},
      </if>
      <if test="ztlx != null">
        ZTLX = #{ztlx,jdbcType=VARCHAR},
      </if>
    </set>
    where XYDM = #{xydm,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kysoft.cpsi.repo.entity.Sczt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 21 17:26:36 CST 2016.
    -->
    update T_SCZT
    set NAME = #{name,jdbcType=VARCHAR},
      HYFL = #{hyfl,jdbcType=DECIMAL},
      ZZXS = #{zzxs,jdbcType=DECIMAL},
      JYZT = #{jyzt,jdbcType=DECIMAL},
      FR = #{fr,jdbcType=VARCHAR},
      LXDH = #{lxdh,jdbcType=VARCHAR},
      MAIL = #{mail,jdbcType=VARCHAR},
      DJJG = #{djjg,jdbcType=VARCHAR},
      JYDZ = #{jydz,jdbcType=VARCHAR},
      LLR = #{llr,jdbcType=VARCHAR},
      QYBM = #{qybm,jdbcType=VARCHAR},
      QYMC = #{qymc,jdbcType=VARCHAR},
      CLRQ = #{clrq,jdbcType=TIMESTAMP},
      ZS = #{zs,jdbcType=VARCHAR},
      ZTLX = #{ztlx,jdbcType=VARCHAR}
    where XYDM = #{xydm,jdbcType=VARCHAR}
  </update>


    <resultMap extends="BaseResultMap" id="ExtendResultMap" type="com.kysoft.cpsi.repo.entity.Sczt">
        <result column="HCRWS" jdbcType="DECIMAL" property="hcrws" />
        <result column="DJJGMC" jdbcType="DECIMAL" property="djjgMc" />
    </resultMap>

    <select id="query" resultMap="ExtendResultMap">
        select 'false' as QUERYID, <include refid="Base_Column_List" />, 
        (SELECT NAME FROM SYS_ORGANIZATION t WHERE t.id=DJJG) DJJGMC,
        (select count(1) from t_hcrw b where b.hcdw_xydm=a.xydm) hcrws
        from T_SCZT a where
        (
            (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) e where e.id=a.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)
            or exists(select hcdw_xydm from t_hcrw e where (e.zfry_code1=(select zfry from sys_user where user_id=#{_userId}) or e.zfry_code2=(select zfry from sys_user where user_id=#{_userId}))  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_js_hcrw e where (e.zfry_code=(select zfry from sys_user where user_id=#{_userId}))  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_hcrw e where (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) f where f.id=e.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_js_hcrw e where (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) f where f.id=e.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)  and a.xydm=e.hcdw_xydm)
        )
        <if test="xydm!=null">
            and xydm=#{xydm}
        </if>
        <if test="hyfl!=null">
            and hyfl=#{hyfl}
        </if>
        <if test="zzxs!=null">
            and zzxs=#{zzxs}
        </if>
        <if test="jyzt!=null">
            and jyzt=#{jyzt}
        </if>
        <if test="hyfl!=null">
            and hyfl=#{hyfl}
        </if>
        <if test="qy!=null">
            and QYMC like #{qy}||'%'
        </if>
        <if test="qymc!=null">
            and NAME like concat(concat('%', #{qymc}), '%')
        </if>
        <if test="dwId!=null">
            and qybm like #{dwId}||'%'
        </if>
        <if test="planType!=null">
            and exists(select 1 from t_hcrw b where b.PLAN_TYPE=#{planType} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="jhnd!=null">
            and exists(select 1 from t_hcrw b where b.jhnd=#{jhnd} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="jhbh!=null">
            and exists(select 1 from t_hcrw b where b.jhbh=#{jhbh} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="hcry!=null">
            and exists(select 1 from t_hcrw b where (b.ZFRY_NAME1 like #{hcry}||'%' or b.ZFRY_NAME2 like #{hcry}||'%')
            and
            a.xydm=b.hcdw_xydm)
        </if>
        <if test="hcjieguo!=null">
            and exists(select 1 from t_hcrw b where b.hcjieguo=#{hcjieguo} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="jhmc!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.jhmc like '%'||#{jhmc}||'%')
        </if>
        <if test="cxwh!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.cxwh = #{cxwh})
        </if>
        <if test="gsjhbh!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.gsjhbh =#{gsjhbh})
        </if>
        ORDER BY NAME
    </select>
    <select id="queryExt" resultMap="ExtendResultMap">
        select 'false' as QUERYID, <include refid="Base_Column_List" />, 
        (SELECT NAME FROM SYS_ORGANIZATION t WHERE t.id=DJJG) DJJGMC,
        (select count(1) from t_hcrw b where b.hcdw_xydm=a.xydm) hcrws
        from T_SCZT a where 1=1
        <if test="xydm!=null">
            and xydm=#{xydm}
        </if>
        <if test="hyfl!=null">
            and hyfl=#{hyfl}
        </if>
        <if test="zzxs!=null">
            and zzxs=#{zzxs}
        </if>
        <if test="jyzt!=null">
            and jyzt=#{jyzt}
        </if>
        <if test="hyfl!=null">
            and hyfl=#{hyfl}
        </if>
        <if test="dwId!=null">
            and qybm like #{dwId}||'%'
        </if>
        <if test="planType!=null">
            and exists(select 1 from t_hcrw b where b.PLAN_TYPE=#{planType} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="jhnd!=null">
            and exists(select 1 from t_hcrw b where b.nd=#{jhnd} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="jhbh!=null">
            and exists(select 1 from t_hcrw b where b.jhbh=#{jhbh} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="hcry!=null">
            and exists(select 1 from t_hcrw b where (b.ZFRY_NAME1 like #{hcry}||'%' or b.ZFRY_NAME2 like #{hcry}||'%')
            and a.xydm=b.hcdw_xydm)
        </if>
        <if test="hcjieguo!=null">
            and exists(select 1 from t_hcrw b where b.hcjieguo=#{hcjieguo} and a.xydm=b.hcdw_xydm)
        </if>
        <if test="qy!=null">
            and QYMC like #{qy}||'%'
        </if>
        <if test="qymc!=null">
            and NAME like concat(concat('%', #{qymc}), '%')
        </if>
        <if test="jhmc!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.jhmc like '%'||#{jhmc}||'%')
        </if>
        <if test="cxwh!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.cxwh = #{cxwh})
        </if>
        <if test="gsjhbh!=null">
            and exists(select 1 from t_hcrw b,t_hcjh c where b.hcjh_id=c.id and a.xydm=b.hcdw_xydm and c.gsjhbh =#{gsjhbh})
        </if>
        AND (
            (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) e where e.id=a.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)
            or exists(select hcdw_xydm from t_hcrw e where (e.zfry_code1=(select zfry from sys_user where user_id=#{_userId}) or e.zfry_code2=(select zfry from sys_user where user_id=#{_userId}))  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_js_hcrw e where (e.zfry_code=(select zfry from sys_user where user_id=#{_userId}))  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_hcrw e where (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) f where f.id=e.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)  and a.xydm=e.hcdw_xydm)
            or exists(select hcdw_xydm from t_js_hcrw e where (exists(select 1 from ( SELECT ID FROM SYS_ORGANIZATION  START WITH ID IN ( SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) CONNECT BY PRIOR ID=PARENT_ID  ) f where f.id=e.djjg) and (select ext1 from sys_user where user_id=#{_userId})=1)  and a.xydm=e.hcdw_xydm)
        )
        ORDER BY NAME
    </select>

    <select id="queryHccl" resultType="java.util.Map">
        select a.id hcrw_id,a.hcjh_id,a.hcdw_xydm,a.hcdw_name,b.nd,b.jhmc,b.jhbh,c.hcsx_id,d.id hccl_id,d.name
        hccl_name,d.hcsxmc,
        (select mongo_id from t_hcclmx e where e.hcrw_id=a.id and e.hcsx_id=c.hcsx_id and e.hcdw_xydm=a.hcdw_xydm and
        e.hcjhnd=a.nd and e.hccl_id=d.id) mongo_id
        from t_hcrw a,t_hcjh b,t_hcjh_hcsx c,t_hccl d
        where a.hcjh_id=b.id
        and b.id=c.hcjh_id
        and c.hcsx_id=d.HCSX_ID
        <if test="xydm!=null">
            and a.hcdw_xydm = #{xydm}
        </if>
        <if test="nd!=null">
            and b.nd = #{nd}
        </if>
        ORDER BY a.id
    </select>

    <select id="selectByXydm" resultMap="BaseResultMap">
        select 'false' as QUERYID,
        <include refid="Base_Column_List" />
        from T_SCZT
        where XYDM = #{xydm,jdbcType=VARCHAR}
    </select>
</mapper>