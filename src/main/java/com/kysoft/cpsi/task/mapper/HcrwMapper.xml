<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kysoft.cpsi.task.mapper.HcrwMapper">
    <resultMap id="BaseResultMap" type="com.kysoft.cpsi.task.entity.Hcrw">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        <id column="ID" jdbcType="VARCHAR" property="id"/>
        <result column="HCJH_ID" jdbcType="VARCHAR" property="hcjhId"/>
        <result column="HCDW_XYDM" jdbcType="VARCHAR" property="hcdwXydm"/>
        <result column="HCDW_NAME" jdbcType="VARCHAR" property="hcdwName"/>
        <result column="ZFRY_CODE1" jdbcType="VARCHAR" property="zfryCode1"/>
        <result column="ZFRY_CODE2" jdbcType="VARCHAR" property="zfryCode2"/>
        <result column="RWZT" jdbcType="NUMERIC" property="rwzt"/>
        <result column="HCFL" jdbcType="NUMERIC" property="hcfl"/>
        <result column="HCJG" jdbcType="VARCHAR" property="hcjg"/>
        <result column="HCJIEGUO" jdbcType="NUMERIC" property="hcjieguo"/>
        <result column="JYZT" jdbcType="NUMERIC" property="jyzt"/>
        <result column="HCJGGSQK" jdbcType="NUMERIC" property="hcjggsqk"/>
        <result column="RLR" jdbcType="VARCHAR" property="rlr"/>
        <result column="RLRQ" jdbcType="DATE" property="rlrq"/>
        <result column="SJWCRQ" jdbcType="DATE" property="sjwcrq"/>
        <result column="ZFRY_NAME1" jdbcType="VARCHAR" property="zfryName1"/>
        <result column="ZFRY_NAME2" jdbcType="VARCHAR" property="zfryName2"/>
        <result column="HCJGMC" jdbcType="VARCHAR" property="hcjgmc"/>
        <result column="DJJGMC" jdbcType="VARCHAR" property="djjgmc"/>
        <result column="DJJG" jdbcType="VARCHAR" property="djjg"/>
        <result column="ZTLX" jdbcType="NUMERIC" property="ztlx"/>
        <result column="ZZXS" jdbcType="NUMERIC" property="zzxs"/>
        <result column="QYBM" jdbcType="VARCHAR" property="qybm"/>
        <result column="QYMC" jdbcType="VARCHAR" property="qymc"/>
        <result column="RLRMC" jdbcType="VARCHAR" property="rlrmc"/>
        <result column="JHWCRQ" jdbcType="DATE" property="jhwcrq"/>
        <result column="ND" jdbcType="NUMERIC" property="nd"/>
        <result column="JHMC" jdbcType="VARCHAR" property="jhmc"/>
        <result column="JHXDRQ" jdbcType="DATE" property="jhxdrq"/>
        <result column="JHYQWCSJ" jdbcType="DATE" property="jhyqwcsj"/>
        <result column="DATA_LOADED" jdbcType="DECIMAL" property="dataLoaded"/>
        <result column="NR" jdbcType="NUMERIC" property="nr"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        ID, HCJH_ID, HCDW_XYDM, HCDW_NAME, ZFRY_CODE1, ZFRY_CODE2, RWZT, HCFL, HCJG, HCJIEGUO,
        JYZT, HCJGGSQK, RLR, RLRQ, SJWCRQ, ZFRY_NAME1, ZFRY_NAME2, HCJGMC, DJJGMC, DJJG,
        ZTLX, ZZXS, QYBM, QYMC, RLRMC, JHWCRQ, ND, JHMC, JHXDRQ, JHYQWCSJ, DATA_LOADED, NR
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        select 'false' as QUERYID,
        <include refid="Base_Column_List"/>
        from T_HCRW
        where ID = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        delete from T_HCRW
        where ID = #{id,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.kysoft.cpsi.task.entity.Hcrw">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        insert into T_HCRW (ID, HCJH_ID, HCDW_XYDM,
        HCDW_NAME, ZFRY_CODE1, ZFRY_CODE2,
        RWZT, HCFL, HCJG, HCJIEGUO,
        JYZT, HCJGGSQK, RLR,
        RLRQ, SJWCRQ, ZFRY_NAME1,
        ZFRY_NAME2, HCJGMC, DJJGMC,
        DJJG, ZTLX, ZZXS, QYBM,
        QYMC, RLRMC, JHWCRQ,
        ND, JHMC, JHXDRQ,
        JHYQWCSJ, DATA_LOADED, NR
        )
        values (#{id,jdbcType=VARCHAR}, #{hcjhId,jdbcType=VARCHAR}, #{hcdwXydm,jdbcType=VARCHAR},
        #{hcdwName,jdbcType=VARCHAR}, #{zfryCode1,jdbcType=VARCHAR}, #{zfryCode2,jdbcType=VARCHAR},
        #{rwzt,jdbcType=NUMERIC}, #{hcfl,jdbcType=NUMERIC}, #{hcjg,jdbcType=VARCHAR}, #{hcjieguo,jdbcType=NUMERIC},
        #{jyzt,jdbcType=NUMERIC}, #{hcjggsqk,jdbcType=NUMERIC}, #{rlr,jdbcType=VARCHAR},
        #{rlrq,jdbcType=DATE}, #{sjwcrq,jdbcType=DATE}, #{zfryName1,jdbcType=VARCHAR},
        #{zfryName2,jdbcType=VARCHAR}, #{hcjgmc,jdbcType=VARCHAR}, #{djjgmc,jdbcType=VARCHAR},
        #{djjg,jdbcType=VARCHAR}, #{ztlx,jdbcType=NUMERIC}, #{zzxs,jdbcType=NUMERIC}, #{qybm,jdbcType=VARCHAR},
        #{qymc,jdbcType=VARCHAR}, #{rlrmc,jdbcType=VARCHAR}, #{jhwcrq,jdbcType=DATE},
        #{nd,jdbcType=NUMERIC}, #{jhmc,jdbcType=VARCHAR}, #{jhxdrq,jdbcType=DATE},
        #{jhyqwcsj,jdbcType=DATE}, #{dataLoaded,jdbcType=DECIMAL}, #{nr,jdbcType=NUMERIC}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.kysoft.cpsi.task.entity.Hcrw">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        insert into T_HCRW
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="hcjhId != null">
                HCJH_ID,
            </if>
            <if test="hcdwXydm != null">
                HCDW_XYDM,
            </if>
            <if test="hcdwName != null">
                HCDW_NAME,
            </if>
            <if test="zfryCode1 != null">
                ZFRY_CODE1,
            </if>
            <if test="zfryCode2 != null">
                ZFRY_CODE2,
            </if>
            <if test="rwzt != null">
                RWZT,
            </if>
            <if test="hcfl != null">
                HCFL,
            </if>
            <if test="hcjg != null">
                HCJG,
            </if>
            <if test="hcjieguo != null">
                HCJIEGUO,
            </if>
            <if test="jyzt != null">
                JYZT,
            </if>
            <if test="hcjggsqk != null">
                HCJGGSQK,
            </if>
            <if test="rlr != null">
                RLR,
            </if>
            <if test="rlrq != null">
                RLRQ,
            </if>
            <if test="sjwcrq != null">
                SJWCRQ,
            </if>
            <if test="zfryName1 != null">
                ZFRY_NAME1,
            </if>
            <if test="zfryName2 != null">
                ZFRY_NAME2,
            </if>
            <if test="hcjgmc != null">
                HCJGMC,
            </if>
            <if test="djjgmc != null">
                DJJGMC,
            </if>
            <if test="djjg != null">
                DJJG,
            </if>
            <if test="ztlx != null">
                ZTLX,
            </if>
            <if test="zzxs != null">
                ZZXS,
            </if>
            <if test="qybm != null">
                QYBM,
            </if>
            <if test="qymc != null">
                QYMC,
            </if>
            <if test="rlrmc != null">
                RLRMC,
            </if>
            <if test="jhwcrq != null">
                JHWCRQ,
            </if>
            <if test="nd != null">
                ND,
            </if>
            <if test="jhmc != null">
                JHMC,
            </if>
            <if test="jhxdrq != null">
                JHXDRQ,
            </if>
            <if test="jhyqwcsj != null">
                JHYQWCSJ,
            </if>
            <if test="dataLoaded != null">
                DATA_LOADED,
            </if>
            <if test="nr != null">
                NR,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="hcjhId != null">
                #{hcjhId,jdbcType=VARCHAR},
            </if>
            <if test="hcdwXydm != null">
                #{hcdwXydm,jdbcType=VARCHAR},
            </if>
            <if test="hcdwName != null">
                #{hcdwName,jdbcType=VARCHAR},
            </if>
            <if test="zfryCode1 != null">
                #{zfryCode1,jdbcType=VARCHAR},
            </if>
            <if test="zfryCode2 != null">
                #{zfryCode2,jdbcType=VARCHAR},
            </if>
            <if test="rwzt != null">
                #{rwzt,jdbcType=NUMERIC},
            </if>
            <if test="hcfl != null">
                #{hcfl,jdbcType=NUMERIC},
            </if>
            <if test="hcjg != null">
                #{hcjg,jdbcType=VARCHAR},
            </if>
            <if test="hcjieguo != null">
                #{hcjieguo,jdbcType=NUMERIC},
            </if>
            <if test="jyzt != null">
                #{jyzt,jdbcType=NUMERIC},
            </if>
            <if test="hcjggsqk != null">
                #{hcjggsqk,jdbcType=NUMERIC},
            </if>
            <if test="rlr != null">
                #{rlr,jdbcType=VARCHAR},
            </if>
            <if test="rlrq != null">
                #{rlrq,jdbcType=DATE},
            </if>
            <if test="sjwcrq != null">
                #{sjwcrq,jdbcType=DATE},
            </if>
            <if test="zfryName1 != null">
                #{zfryName1,jdbcType=VARCHAR},
            </if>
            <if test="zfryName2 != null">
                #{zfryName2,jdbcType=VARCHAR},
            </if>
            <if test="hcjgmc != null">
                #{hcjgmc,jdbcType=VARCHAR},
            </if>
            <if test="djjgmc != null">
                #{djjgmc,jdbcType=VARCHAR},
            </if>
            <if test="djjg != null">
                #{djjg,jdbcType=VARCHAR},
            </if>
            <if test="ztlx != null">
                #{ztlx,jdbcType=NUMERIC},
            </if>
            <if test="zzxs != null">
                #{zzxs,jdbcType=NUMERIC},
            </if>
            <if test="qybm != null">
                #{qybm,jdbcType=VARCHAR},
            </if>
            <if test="qymc != null">
                #{qymc,jdbcType=VARCHAR},
            </if>
            <if test="rlrmc != null">
                #{rlrmc,jdbcType=VARCHAR},
            </if>
            <if test="jhwcrq != null">
                #{jhwcrq,jdbcType=DATE},
            </if>
            <if test="nd != null">
                #{nd,jdbcType=NUMERIC},
            </if>
            <if test="jhmc != null">
                #{jhmc,jdbcType=VARCHAR},
            </if>
            <if test="jhxdrq != null">
                #{jhxdrq,jdbcType=DATE},
            </if>
            <if test="jhyqwcsj != null">
                #{jhyqwcsj,jdbcType=DATE},
            </if>
            <if test="dataLoaded != null">
                #{dataLoaded,jdbcType=DECIMAL},
            </if>
            <if test="nr != null">
                #{nr,jdbcType=NUMERIC},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.kysoft.cpsi.task.entity.Hcrw">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        update T_HCRW
        <set>
            <if test="hcjhId != null">
                HCJH_ID = #{hcjhId,jdbcType=VARCHAR},
            </if>
            <if test="hcdwXydm != null">
                HCDW_XYDM = #{hcdwXydm,jdbcType=VARCHAR},
            </if>
            <if test="hcdwName != null">
                HCDW_NAME = #{hcdwName,jdbcType=VARCHAR},
            </if>
            <if test="zfryCode1 != null">
                ZFRY_CODE1 = #{zfryCode1,jdbcType=VARCHAR},
            </if>
            <if test="zfryCode2 != null">
                ZFRY_CODE2 = #{zfryCode2,jdbcType=VARCHAR},
            </if>
            <if test="rwzt != null">
                RWZT = #{rwzt,jdbcType=NUMERIC},
            </if>
            <if test="hcfl != null">
                HCFL = #{hcfl,jdbcType=NUMERIC},
            </if>
            <if test="hcjg != null">
                HCJG = #{hcjg,jdbcType=VARCHAR},
            </if>
            <if test="hcjieguo != null">
                HCJIEGUO = #{hcjieguo,jdbcType=NUMERIC},
            </if>
            <if test="jyzt != null">
                JYZT = #{jyzt,jdbcType=NUMERIC},
            </if>
            <if test="hcjggsqk != null">
                HCJGGSQK = #{hcjggsqk,jdbcType=NUMERIC},
            </if>
            <if test="rlr != null">
                RLR = #{rlr,jdbcType=VARCHAR},
            </if>
            <if test="rlrq != null">
                RLRQ = #{rlrq,jdbcType=DATE},
            </if>
            <if test="sjwcrq != null">
                SJWCRQ = #{sjwcrq,jdbcType=DATE},
            </if>
            <if test="zfryName1 != null">
                ZFRY_NAME1 = #{zfryName1,jdbcType=VARCHAR},
            </if>
            <if test="zfryName2 != null">
                ZFRY_NAME2 = #{zfryName2,jdbcType=VARCHAR},
            </if>
            <if test="hcjgmc != null">
                HCJGMC = #{hcjgmc,jdbcType=VARCHAR},
            </if>
            <if test="djjgmc != null">
                DJJGMC = #{djjgmc,jdbcType=VARCHAR},
            </if>
            <if test="djjg != null">
                DJJG = #{djjg,jdbcType=VARCHAR},
            </if>
            <if test="ztlx != null">
                ZTLX = #{ztlx,jdbcType=NUMERIC},
            </if>
            <if test="zzxs != null">
                ZZXS = #{zzxs,jdbcType=NUMERIC},
            </if>
            <if test="qybm != null">
                QYBM = #{qybm,jdbcType=VARCHAR},
            </if>
            <if test="qymc != null">
                QYMC = #{qymc,jdbcType=VARCHAR},
            </if>
            <if test="rlrmc != null">
                RLRMC = #{rlrmc,jdbcType=VARCHAR},
            </if>
            <if test="jhwcrq != null">
                JHWCRQ = #{jhwcrq,jdbcType=DATE},
            </if>
            <if test="nd != null">
                ND = #{nd,jdbcType=NUMERIC},
            </if>
            <if test="jhmc != null">
                JHMC = #{jhmc,jdbcType=VARCHAR},
            </if>
            <if test="jhxdrq != null">
                JHXDRQ = #{jhxdrq,jdbcType=DATE},
            </if>
            <if test="jhyqwcsj != null">
                JHYQWCSJ = #{jhyqwcsj,jdbcType=DATE},
            </if>
            <if test="dataLoaded != null">
                DATA_LOADED = #{dataLoaded,jdbcType=DECIMAL},
            </if>
            <if test="nr != null">
                NR = #{nr,jdbcType=NUMERIC},
            </if>
        </set>
        where ID = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.kysoft.cpsi.task.entity.Hcrw">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 02 13:03:30 CST 2016.
        -->
        update T_HCRW
        set HCJH_ID = #{hcjhId,jdbcType=VARCHAR},
        HCDW_XYDM = #{hcdwXydm,jdbcType=VARCHAR},
        HCDW_NAME = #{hcdwName,jdbcType=VARCHAR},
        ZFRY_CODE1 = #{zfryCode1,jdbcType=VARCHAR},
        ZFRY_CODE2 = #{zfryCode2,jdbcType=VARCHAR},
        RWZT = #{rwzt,jdbcType=NUMERIC},
        HCFL = #{hcfl,jdbcType=NUMERIC},
        HCJG = #{hcjg,jdbcType=VARCHAR},
        HCJIEGUO = #{hcjieguo,jdbcType=NUMERIC},
        JYZT = #{jyzt,jdbcType=NUMERIC},
        HCJGGSQK = #{hcjggsqk,jdbcType=NUMERIC},
        RLR = #{rlr,jdbcType=VARCHAR},
        RLRQ = #{rlrq,jdbcType=DATE},
        SJWCRQ = #{sjwcrq,jdbcType=DATE},
        ZFRY_NAME1 = #{zfryName1,jdbcType=VARCHAR},
        ZFRY_NAME2 = #{zfryName2,jdbcType=VARCHAR},
        HCJGMC = #{hcjgmc,jdbcType=VARCHAR},
        DJJGMC = #{djjgmc,jdbcType=VARCHAR},
        DJJG = #{djjg,jdbcType=VARCHAR},
        ZTLX = #{ztlx,jdbcType=NUMERIC},
        ZZXS = #{zzxs,jdbcType=NUMERIC},
        QYBM = #{qybm,jdbcType=VARCHAR},
        QYMC = #{qymc,jdbcType=VARCHAR},
        RLRMC = #{rlrmc,jdbcType=VARCHAR},
        JHWCRQ = #{jhwcrq,jdbcType=DATE},
        ND = #{nd,jdbcType=NUMERIC},
        JHMC = #{jhmc,jdbcType=VARCHAR},
        JHXDRQ = #{jhxdrq,jdbcType=DATE},
        JHYQWCSJ = #{jhyqwcsj,jdbcType=DATE},
        DATA_LOADED = #{dataLoaded,jdbcType=DECIMAL},
        NR = #{nr,jdbcType=NUMERIC}
        where ID = #{id,jdbcType=VARCHAR}
    </update>


    <select id="queryForOrg" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from T_HCRW where HCJH_ID = #{hcjhId}
        AND
        QYBM IN (
	    	SELECT ID FROM SYS_ORGANIZATION START WITH ID IN (
				SELECT ORG_ID FROM T_USER_ORG WHERE USER_ID=#{_userId}) 
			CONNECT BY PRIOR ID=PARENT_ID
	    )
	    
        AND HCJG like concat(#{organization,jdbcType=VARCHAR}, '%')
        ORDER BY

        <if test="order == 1">
            HCJGMC, ZFRY_NAME1, ZFRY_NAME2
        </if>
        <if test="order ==2">
            ZZXS, HCJGMC
        </if>
    </select>
    <select id="queryForXydm" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from T_HCRW where hcdw_xydm=#{hcdwXydm}
        ORDER BY JHWCRQ
    </select>

    <select id="queryForAuditor" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from T_HCRW
        where (ZFRY_CODE1 =  (select zfry from sys_user where user_id=#{_userId,jdbcType=VARCHAR}) or ZFRY_CODE2 =  (select zfry from sys_user where user_id=#{_userId,jdbcType=VARCHAR}))
        <if test="nd!=null">
            AND ND = #{nd}
        </if>
        <if test="hcjhId">
            AND HCJH_ID = #{hcjhId}
        </if>
        <if test="jhmc!=null">
            AND JHMC LIKE concat(concat('%', #{jhmc}), '%')
        </if>
        ORDER BY
        <if test="order != null">
            ${sort} ${order},
        </if>
        RLRQ
    </select>

    <select id="queryForPlan" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from T_HCRW where HCJH_ID = #{planId,jdbcType=VARCHAR}
        ORDER BY
        <if test="order != null">
            ${sort} ${order},
        </if>
        RLRQ
    </select>

    <select id="selectCountByPlanId" resultType="java.lang.Integer">
        select COUNT(*) from T_HCRW WHERE hcjh_id = #{planId,jdbcType=VARCHAR}
    </select>
    
    <select id="selectYrlsByPlanId" resultType="java.lang.Integer">
        select COUNT(*) from T_HCRW WHERE hcjh_id = #{planId,jdbcType=VARCHAR} and RLR IS NOT NULL AND rlrq IS NOT NULL
    </select>

    <update id="pullData" parameterType="java.util.HashMap" statementType="CALLABLE">
        {
        call prc_import_hc(
        #{hcrwId,mode=IN,jdbcType=VARCHAR}
        )}
    </update>

    <update id="updateLoadedByPrimaryKey">
        UPDATE T_HCRW SET DATA_LOADED = 1 where HCJH_ID = #{planId,jdbcType=VARCHAR}
    </update>

    <select id="query" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from T_HCRW
        where HCJH_ID = #{planId,jdbcType=VARCHAR}
        <if test="hcjg!=null">
            and hcjg in (select id from sys_organization start with id=#{hcjg} connect by prior id=parent_id)
        </if>
        ORDER BY
        <if test="order != null">
            ${sort} ${order},
        </if>
        RLRQ
    </select>

    <select id="queryTongJiFenXi" resultType="java.util.Map">
        select id,lpad('　',(level-1)*2,'　')||name name,level,
        (select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        ) heji,
        (select sum(case when hcjieguo =1 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        ) sl_1,
        round((select sum(case when hcjieguo =1 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_1,
        (select sum(case when hcjieguo =2 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )sl_2,
        round((select sum(case when hcjieguo =2 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_2,
        (select sum(case when hcjieguo =3 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )sl_3,
        round((select sum(case when hcjieguo =3 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_3,
        (select sum(case when hcjieguo =4 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )sl_4,
        round((select sum(case when hcjieguo =4 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_4,
        (select sum(case when hcjieguo =5 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )sl_5,
        round((select sum(case when hcjieguo =5 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_5,
        (select sum(case when hcjieguo =6 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )sl_6,
        round((select sum(case when hcjieguo =6 then 1 else 0 end) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )/(select count(1) from t_hcrw b,t_sczt c
        where c.xydm=b.HCDW_XYDM and b.hcjg like a.id||'%'
        <if test="nd!=null">
            and b.nd=#{nd}
        </if>
        <if test="hcjhId!=null">
            and b.hcjh_id=#{hcjhId}
        </if>
        <if test="ztlx!=null">
            and c.ztlx=#{ztlx}
        </if>
        <if test="hyfl!=null">
            and c.hyfl=#{hyfl}
        </if>
        )*100,2) bz_6
        from sys_organization a
        start with id=#{id} connect by prior id=parent_id
        group by id,name,level
        order by id
    </select>

	<update id="updateAccept">
        UPDATE T_HCRW SET RLR = #{userId}, RLRMC = #{userName}, RLRQ = SYSDATE where ID in (
	    <foreach collection="taskIds" index="index" item="taskId" separator="UNION ALL">
	      select #{taskId} from dual
	    </foreach>)
    </update>
	<update id="updateUnAccept">
        UPDATE T_HCRW SET RLR = null, RLRMC = null, RLRQ = null where ID in (
	    <foreach collection="taskIds" index="index" item="taskId" separator="UNION ALL">
	      select #{taskId} from dual
	    </foreach>)
    </update>
</mapper>