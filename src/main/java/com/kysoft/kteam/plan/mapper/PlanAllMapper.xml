<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kysoft.kteam.plan.mapper.PlanAllMapper" >
  <resultMap id="BaseResultMap" type="com.kysoft.kteam.plan.entity.PlanAll" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="IS_DEPT_PLAN" property="isDeptPlan" jdbcType="DECIMAL" />
    <result column="OWNER_ID" property="ownerId" jdbcType="VARCHAR" />
    <result column="OWNER_NAME" property="ownerName" jdbcType="VARCHAR" />
    <result column="DEP_ID" property="depId" jdbcType="VARCHAR" />
    <result column="DEP_NAME" property="depName" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="AUTHOR_ID" property="authorId" jdbcType="VARCHAR" />
    <result column="AUTHOR_NAME" property="authorName" jdbcType="VARCHAR" />
    <result column="APPROVE_TIME" property="approveTime" jdbcType="TIMESTAMP" />
    <result column="APPROVER_ID" property="approverId" jdbcType="VARCHAR" />
    <result column="APPROVER_NAME" property="approverName" jdbcType="VARCHAR" />
    <result column="CYCLE" property="cycle" jdbcType="VARCHAR" />
    <result column="IMPORTANCE" property="importance" jdbcType="DECIMAL" />
    <result column="INSTANCY" property="instancy" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="NEED_VERIFY" property="needVerify" jdbcType="DECIMAL" />
    <result column="VERIFIER" property="verifier" jdbcType="VARCHAR" />
    <result column="IS_ANNUAL_PLAN" property="isAnnualPlan" jdbcType="DECIMAL" />
    <result column="DESCRIPT" property="descript" jdbcType="VARCHAR" />
    <result column="PARENT_ID" property="parentId" jdbcType="VARCHAR" />
    <result column="PARENT_NAME" property="parentName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    ID, NAME, IS_DEPT_PLAN, OWNER_ID, OWNER_NAME, DEP_ID, DEP_NAME, CREATE_TIME, AUTHOR_ID, 
    AUTHOR_NAME, APPROVE_TIME, APPROVER_ID, APPROVER_NAME, CYCLE, IMPORTANCE, INSTANCY, 
    STATUS, START_TIME, END_TIME, NEED_VERIFY, VERIFIER, IS_ANNUAL_PLAN, DESCRIPT, PARENT_ID, 
    PARENT_NAME
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    select 'false' as QUERYID,
    <include refid="Base_Column_List" />
    from T_PLAN_ALL
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    delete from T_PLAN_ALL
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.kysoft.kteam.plan.entity.PlanAll" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    insert into T_PLAN_ALL (ID, NAME, IS_DEPT_PLAN, 
      OWNER_ID, OWNER_NAME, DEP_ID, 
      DEP_NAME, CREATE_TIME, AUTHOR_ID, 
      AUTHOR_NAME, APPROVE_TIME, APPROVER_ID, 
      APPROVER_NAME, CYCLE, IMPORTANCE, 
      INSTANCY, STATUS, START_TIME, 
      END_TIME, NEED_VERIFY, VERIFIER, 
      IS_ANNUAL_PLAN, DESCRIPT, PARENT_ID, 
      PARENT_NAME)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{isDeptPlan,jdbcType=DECIMAL}, 
      #{ownerId,jdbcType=VARCHAR}, #{ownerName,jdbcType=VARCHAR}, #{depId,jdbcType=VARCHAR}, 
      #{depName,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{authorId,jdbcType=VARCHAR}, 
      #{authorName,jdbcType=VARCHAR}, #{approveTime,jdbcType=TIMESTAMP}, #{approverId,jdbcType=VARCHAR}, 
      #{approverName,jdbcType=VARCHAR}, #{cycle,jdbcType=VARCHAR}, #{importance,jdbcType=DECIMAL}, 
      #{instancy,jdbcType=DECIMAL}, #{status,jdbcType=DECIMAL}, #{startTime,jdbcType=TIMESTAMP}, 
      #{endTime,jdbcType=TIMESTAMP}, #{needVerify,jdbcType=DECIMAL}, #{verifier,jdbcType=VARCHAR}, 
      #{isAnnualPlan,jdbcType=DECIMAL}, #{descript,jdbcType=VARCHAR}, #{parentId,jdbcType=VARCHAR}, 
      #{parentName,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.kysoft.kteam.plan.entity.PlanAll" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    insert into T_PLAN_ALL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="name != null" >
        NAME,
      </if>
      <if test="isDeptPlan != null" >
        IS_DEPT_PLAN,
      </if>
      <if test="ownerId != null" >
        OWNER_ID,
      </if>
      <if test="ownerName != null" >
        OWNER_NAME,
      </if>
      <if test="depId != null" >
        DEP_ID,
      </if>
      <if test="depName != null" >
        DEP_NAME,
      </if>
      <if test="createTime != null" >
        CREATE_TIME,
      </if>
      <if test="authorId != null" >
        AUTHOR_ID,
      </if>
      <if test="authorName != null" >
        AUTHOR_NAME,
      </if>
      <if test="approveTime != null" >
        APPROVE_TIME,
      </if>
      <if test="approverId != null" >
        APPROVER_ID,
      </if>
      <if test="approverName != null" >
        APPROVER_NAME,
      </if>
      <if test="cycle != null" >
        CYCLE,
      </if>
      <if test="importance != null" >
        IMPORTANCE,
      </if>
      <if test="instancy != null" >
        INSTANCY,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="startTime != null" >
        START_TIME,
      </if>
      <if test="endTime != null" >
        END_TIME,
      </if>
      <if test="needVerify != null" >
        NEED_VERIFY,
      </if>
      <if test="verifier != null" >
        VERIFIER,
      </if>
      <if test="isAnnualPlan != null" >
        IS_ANNUAL_PLAN,
      </if>
      <if test="descript != null" >
        DESCRIPT,
      </if>
      <if test="parentId != null" >
        PARENT_ID,
      </if>
      <if test="parentName != null" >
        PARENT_NAME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="isDeptPlan != null" >
        #{isDeptPlan,jdbcType=DECIMAL},
      </if>
      <if test="ownerId != null" >
        #{ownerId,jdbcType=VARCHAR},
      </if>
      <if test="ownerName != null" >
        #{ownerName,jdbcType=VARCHAR},
      </if>
      <if test="depId != null" >
        #{depId,jdbcType=VARCHAR},
      </if>
      <if test="depName != null" >
        #{depName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="authorId != null" >
        #{authorId,jdbcType=VARCHAR},
      </if>
      <if test="authorName != null" >
        #{authorName,jdbcType=VARCHAR},
      </if>
      <if test="approveTime != null" >
        #{approveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="approverId != null" >
        #{approverId,jdbcType=VARCHAR},
      </if>
      <if test="approverName != null" >
        #{approverName,jdbcType=VARCHAR},
      </if>
      <if test="cycle != null" >
        #{cycle,jdbcType=VARCHAR},
      </if>
      <if test="importance != null" >
        #{importance,jdbcType=DECIMAL},
      </if>
      <if test="instancy != null" >
        #{instancy,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=DECIMAL},
      </if>
      <if test="startTime != null" >
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="needVerify != null" >
        #{needVerify,jdbcType=DECIMAL},
      </if>
      <if test="verifier != null" >
        #{verifier,jdbcType=VARCHAR},
      </if>
      <if test="isAnnualPlan != null" >
        #{isAnnualPlan,jdbcType=DECIMAL},
      </if>
      <if test="descript != null" >
        #{descript,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null" >
        #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="parentName != null" >
        #{parentName,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.kysoft.kteam.plan.entity.PlanAll" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    update T_PLAN_ALL
    <set >
      <if test="name != null" >
        NAME = #{name,jdbcType=VARCHAR},
      </if>
      <if test="isDeptPlan != null" >
        IS_DEPT_PLAN = #{isDeptPlan,jdbcType=DECIMAL},
      </if>
      <if test="ownerId != null" >
        OWNER_ID = #{ownerId,jdbcType=VARCHAR},
      </if>
      <if test="ownerName != null" >
        OWNER_NAME = #{ownerName,jdbcType=VARCHAR},
      </if>
      <if test="depId != null" >
        DEP_ID = #{depId,jdbcType=VARCHAR},
      </if>
      <if test="depName != null" >
        DEP_NAME = #{depName,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="authorId != null" >
        AUTHOR_ID = #{authorId,jdbcType=VARCHAR},
      </if>
      <if test="authorName != null" >
        AUTHOR_NAME = #{authorName,jdbcType=VARCHAR},
      </if>
      <if test="approveTime != null" >
        APPROVE_TIME = #{approveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="approverId != null" >
        APPROVER_ID = #{approverId,jdbcType=VARCHAR},
      </if>
      <if test="approverName != null" >
        APPROVER_NAME = #{approverName,jdbcType=VARCHAR},
      </if>
      <if test="cycle != null" >
        CYCLE = #{cycle,jdbcType=VARCHAR},
      </if>
      <if test="importance != null" >
        IMPORTANCE = #{importance,jdbcType=DECIMAL},
      </if>
      <if test="instancy != null" >
        INSTANCY = #{instancy,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=DECIMAL},
      </if>
      <if test="startTime != null" >
        START_TIME = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        END_TIME = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="needVerify != null" >
        NEED_VERIFY = #{needVerify,jdbcType=DECIMAL},
      </if>
      <if test="verifier != null" >
        VERIFIER = #{verifier,jdbcType=VARCHAR},
      </if>
      <if test="isAnnualPlan != null" >
        IS_ANNUAL_PLAN = #{isAnnualPlan,jdbcType=DECIMAL},
      </if>
      <if test="descript != null" >
        DESCRIPT = #{descript,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null" >
        PARENT_ID = #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="parentName != null" >
        PARENT_NAME = #{parentName,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kysoft.kteam.plan.entity.PlanAll" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 14:49:25 GMT+08:00 2015.
    -->
    update T_PLAN_ALL
    set NAME = #{name,jdbcType=VARCHAR},
      IS_DEPT_PLAN = #{isDeptPlan,jdbcType=DECIMAL},
      OWNER_ID = #{ownerId,jdbcType=VARCHAR},
      OWNER_NAME = #{ownerName,jdbcType=VARCHAR},
      DEP_ID = #{depId,jdbcType=VARCHAR},
      DEP_NAME = #{depName,jdbcType=VARCHAR},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      AUTHOR_ID = #{authorId,jdbcType=VARCHAR},
      AUTHOR_NAME = #{authorName,jdbcType=VARCHAR},
      APPROVE_TIME = #{approveTime,jdbcType=TIMESTAMP},
      APPROVER_ID = #{approverId,jdbcType=VARCHAR},
      APPROVER_NAME = #{approverName,jdbcType=VARCHAR},
      CYCLE = #{cycle,jdbcType=VARCHAR},
      IMPORTANCE = #{importance,jdbcType=DECIMAL},
      INSTANCY = #{instancy,jdbcType=DECIMAL},
      STATUS = #{status,jdbcType=DECIMAL},
      START_TIME = #{startTime,jdbcType=TIMESTAMP},
      END_TIME = #{endTime,jdbcType=TIMESTAMP},
      NEED_VERIFY = #{needVerify,jdbcType=DECIMAL},
      VERIFIER = #{verifier,jdbcType=VARCHAR},
      IS_ANNUAL_PLAN = #{isAnnualPlan,jdbcType=DECIMAL},
      DESCRIPT = #{descript,jdbcType=VARCHAR},
      PARENT_ID = #{parentId,jdbcType=VARCHAR},
      PARENT_NAME = #{parentName,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>

  <select id="selectPlansByParentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 'false' as QUERYID,
    <include refid="Base_Column_List" />
    from T_PLAN_ALL
    where
    <if test="id == null">
      PARENT_ID is null
    </if>
    <if test="id != null">
      PARENT_ID = #{id,jdbcType=VARCHAR}
    </if>
  </select>

  <select id="selectPlanTreeByParentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 'false' as QUERYID,
    <include refid="Base_Column_List" />
    from T_PLAN_ALL
    <if test="id == null">
        START WITH PARENT_ID is null
    </if>
      <if test="id != null">
          START WITH PARENT_ID = #{id,jdbcType=VARCHAR}
      </if>
    CONNECT BY PRIOR ID=PARENT_ID
  </select>

  <select id="queryPersonalPlan" resultMap="BaseResultMap" >
    select 'false' as QUERYID,
    <include refid="Base_Column_List" />
    from T_PLAN_ALL
    WHERE IS_DEPT_PLAN=0 AND PARENT_ID IS NULL AND OWNER_ID=#{_userId}
    ORDER BY
    <if test="order != null">
      ${sort} ${order},
    </if>
    CREATE_TIME DESC
  </select>

  <!-- oracle
  <select id="selectPlanDetailByParentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select decode(connect_by_isleaf, 0, 1, 0) as ISPARENT, <include refid="Base_Column_List" />
    from t_plan_all where PARENT_ID = #{id,jdbcType=VARCHAR}
    START WITH PARENT_ID = #{id,jdbcType=VARCHAR} CONNECT BY PRIOR ID = PARENT_ID
    order by NAME
  </select>
  -->

  <select id="selectPlanDetailByParentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <![CDATA[
    select (select sign(count(*)) from T_PLAN_ALL d where 0 <> (select count(*) from T_PLAN_ALL f where f.PARENT_ID = e.ID)) as ISPARENT,
    ]]>
    <include refid="Base_Column_List" />
    from T_PLAN_ALL e
    where PARENT_ID = #{id,jdbcType=VARCHAR}
    order by NAME
  </select>

</mapper>